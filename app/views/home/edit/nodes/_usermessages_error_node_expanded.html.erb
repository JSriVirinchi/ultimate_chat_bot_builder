<div class="row">
	<div class="col-1 text-center mt-2 ml-2">
		<%= image_tag('redflash.JPG', size: "14", class: "rounded-circle")%>
	</div>
	<div class="col-6 mt-2", style="padding-right: 5px;">
		Error Response
	</div>
	<div class="error_node_expanded_white">
		<div class= "mb-2">
			Fist error message
		</div>
		<%if Node.where(bot_id: @bot.id, parent_id: @node.id, node_type: "error").first%>
			<% @error_node = Node.where(bot_id: @bot.id, parent_id: @node.id, node_type: "error").first %>

			<% error_message = "error_message_" + (@error_node.id).to_s%>			
			<% link_to_node = "link_to_node_" + (@error_node.id).to_s%>			
			<% exit_message = "exit_message_" + (@error_node.id).to_s %>
			
			<% error_message_text_area = "error_message_text_area_" + (@error_node.id).to_s%>
			<% link_to_node_text_and_dropdown = "link_to_node_text_and_dropdown" + (@error_node.id).to_s%>
			<% exit_message_text_area = "exit_message_text_area" + (@error_node.id).to_s %>

			<%= form_with scope: :error_node, url: error_node_save_path(@error_node.id), method: :post,  remote: true do |f| %>
				<div class="mt-1">
					<%= f.radio_button :error_node , "error_message", id: error_message %>
					<%= f.label :error_node , "Send error message", value: "error_message" , class: "ml-2 error_message_text"%>
				</div>
				<div class="ml-3 mt-2 mb-2 hide" id= <%= error_message_text_area%>>
					<%= text_area(:error_node, :error_node_message, cols: 32, rows: 2, class: ' error_node_message_text_area error_node_message_text_area_text', value: "I did not understand what you have said. Please rephrase it.")%>
				</div>
				<div class="mt-1">
					<%= f.radio_button :error_node , "link_to_node", id: link_to_node %>
					<%= f.label :error_node , "Link to another node", value: "link_to_node" , class: "ml-2 error_message_text"%>
				</div>
				<div class="hide" id= <%= link_to_node_text_and_dropdown%>>
					<div class="dropdown show mb-2 ml-3">
					  <a class="btn btn-outline-secondary btn-sm dropdown-toggle" href="#" role="button" id="dropid" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false", style="width: 240px; background-color: transparent; color: grey; border-color: grey;">
					    Select Node
					  </a>
					  <div class="dropdown-menu" aria-labelledby="dropid", style="width: 240px;">
					  	<% for node in Node.where(bot_id: @bot.id, node_type: "bot")%>
					  		<a class="dropdown-item" href= <%= root_path %> ><%= truncate(node.name, length: 30)%></a>
					    <%end%>				    
					  </div>
					</div>
					<div class="ml-3 mt-2 mb-2">
						<%= text_area(:error_node, :error_node_link_to_message, cols: 32, rows: 2, class: ' error_node_message_text_area error_node_message_text_area_text', value: "Ok. Lets start from the beginning")%>
					</div>
				</div>
				<div class="mt-1">
					<%= f.radio_button :error_node , "exit_message", id: exit_message, checked: "checked" %>
					<%= f.label :error_node , "Exit conversation", value: "exit_message" , class: "ml-2 error_message_text"%>
				</div>
				<div class="ml-3 mt-2 mb-2" id= <%= exit_message_text_area%>>
					<%= text_area(:error_node, :error_node_exit_message, cols: 32, rows: 2, class: ' error_node_message_text_area error_node_message_text_area_text', value: "Sorry, I did not get what you said. Exiting the conversation.")%>
				</div>
				<div>
					<%= f.submit "Save", class: "btn btn-sm btn-outline-secondary ml-3 mt-2", style: "color: grey; width: 240px;"%>
				</div>
			<% end %>
		<%end%>
	</div>
</div>

<script type="text/javascript">
	<%if Node.where(bot_id: @bot.id, parent_id: @node.id, node_type: "error").first%>
	<%if Message.where(bot_id: @bot.id, node_id: @error_node.id, node_type: "error").first%>
		<% @error_node = Node.where(bot_id: @bot.id, parent_id: @node.id, node_type: "error").first %>
		<% @message = Message.where(bot_id: @bot.id, node_id: @error_node.id, node_type: "error").first %>
		<%if @message.error_node == "error_message"%>
			document.getElementById('<%= error_message %>').checked = true;
			document.getElementById('<%= link_to_node %>').checked = false;
			document.getElementById('<%= exit_message%>').checked = false;

			document.getElementById('<%= error_message_text_area%>').classList.remove('hide');
			document.getElementById('<%= link_to_node_text_and_dropdown%>').classList.add('hide');			
			document.getElementById('<%= exit_message_text_area%>').classList.add('hide');
		<%elsif @message.error_node == "link_to_node"%>
			document.getElementById('<%= error_message %>').checked = false;
			document.getElementById('<%= link_to_node %>').checked = true;
			document.getElementById('<%= exit_message%>').checked = false;

			document.getElementById('<%= error_message_text_area%>').classList.add('hide');
			document.getElementById('<%= link_to_node_text_and_dropdown%>').classList.remove('hide');			
			document.getElementById('<%= exit_message_text_area%>').classList.add('hide');
		<%elsif @message.error_node == "exit_message"%>
			document.getElementById('<%= error_message %>').checked = false;
			document.getElementById('<%= link_to_node %>').checked = false;
			document.getElementById('<%= exit_message%>').checked = true;

			document.getElementById('<%= error_message_text_area%>').classList.add('hide');
			document.getElementById('<%= link_to_node_text_and_dropdown%>').classList.add('hide');			
			document.getElementById('<%= exit_message_text_area%>').classList.remove('hide');
		<%end%>

		document.getElementById('<%= error_message %>').onclick = function() {
			document.getElementById('<%= error_message_text_area%>').classList.remove('hide');
			document.getElementById('<%= link_to_node_text_and_dropdown%>').classList.add('hide');			
			document.getElementById('<%= exit_message_text_area%>').classList.add('hide');
		}
		document.getElementById('<%= link_to_node %>').onclick = function() {
			document.getElementById('<%= error_message_text_area%>').classList.add('hide');
			document.getElementById('<%= link_to_node_text_and_dropdown%>').classList.remove('hide');			
			document.getElementById('<%= exit_message_text_area%>').classList.add('hide');
		}
		document.getElementById('<%= exit_message %>').onclick = function() {
		 	document.getElementById('<%= error_message_text_area%>').classList.add('hide');
			document.getElementById('<%= link_to_node_text_and_dropdown%>').classList.add('hide');			
			document.getElementById('<%= exit_message_text_area%>').classList.remove('hide');
		}
	<%end%>
	<%end%>		
</script>