<!-- declaring ids -->
<% @node = Node.where(bot_id: @bot.id, parent_id: parent_id).first%>

<%if @node%> 
<% botresponses_box_after = "botresponses_box_after_" + (@node.id).to_s %>
<% botmessages_previous = "botmessages_previous_" + (@node.id).to_s %>
<% botresponses_messages_area_text_area = "botresponses_messages_area_text_area_" + (@node.id).to_s%>
<%end%>

<!-- content -->
<div class="botresponses_box_after hide mb-4" id="<%= botresponses_box_after %>">
	<div class="row">
		<div class="col-10 row mb-2">
			<%= image_tag('chatbot.JPG', size: "25", class: "rounded-circle mr-3 ml-4 mt-2")%>
			<div class="botresponses_text">Bot Response</div>
		</div>
		<div class="col-2 text-center">
			<% if Node.where(bot_id: @bot.id, parent_id: parent_id).first%>
			<%= link_to image_tag('dustbin.png', size: "15", class: "mt-2 mr-2"), nodes_destroy_path(@node.id), method: :delete , remote: true, data: { confirm: "Are you sure that you want to delete this node? This will delete all the children nodes attached to it. You can edit the current node, if you wanted to."}%>
			<% end %>
		</div>
	</div>

	<div class="card_divider mb-2"></div>

	<!-- added messages -->
	<div id="<%= botmessages_previous%>">
		<%= render 'home/edit/nodes/botmessages_previous', delete_button: true %>
	</div>
	<!-- text area -->
	<%= form_with scope: :message, url: nodes_message_create_path, method: :post,  remote: true do |f| %>
	<div class="text-center mx-auto">
		<div class="text-center botresponses_messages_area_full">
			<%= text_area(:message, :text_messages, cols: 30, rows: 4, class: 'botresponses_messages_area', value: "", id: botresponses_messages_area_text_area, remote: true)%>
			<%= f.text_field :node_type, value: "bot", class: "hide"%>
			<%= f.text_field :bot_id, value: @bot.id , class: "hide"%>
			<% if Node.where(bot_id: @bot.id, parent_id: parent_id).first%>
			<%= f.text_field :node_id, value: @node.id, class: "hide"%>
			<% end %>
			<div class="card_divider_two ml-2 mt-2 mb-1"></div>
			<div class="row mb-1 ml-2">
				<div class="col-4 mt-2">
					<%= link_to image_tag('boldicon.png', size: "12", class: ""), root_path %>
					<%= link_to image_tag('italics.jpg', size: "12", class: "ml-1"), root_path %>
					<%= link_to image_tag('underline.png', size: "15", class: "ml-1"), root_path %>
				</div>
				<div class="col-8" style="text-align: right;">
					<%= f.submit "Add", value: "Add", class: "btn btn-outline-secondary btn-sm mr-4", style: "height: 30px; margin-top: 5px; text-align: right;"%>
				</div>
			</div>
		</div>
	</div>
	<% end %>

	<!-- options -->
	<div class="row">
		<div class="options_text ml-3 mb-2 mt-1 col-4">
			Add Message
		</div>
		<div class="ml-2 ">
			<%= link_to image_tag('addbutton.JPG', size: "25", class: "ml-1"), root_path %>
		</div>
	</div>
	<div class="row mt-2 mb-2">
		<div class="options_text ml-3 mb-2 mt-1 col-4">
			Attach Media
		</div>
		<div class="ml-2 ">
			<%= link_to image_tag('photoicon.JPG', size: "25", class: "ml-1"), root_path %>
			<%= link_to image_tag('videoicon.JPG', size: "25", class: "ml-1"), root_path %>
			<%= link_to image_tag('pdficon.JPG', size: "25", class: "ml-1"), root_path %>
		</div>
	</div>
	<div class="row mb-2">
		<div class="options_text ml-3 mb-2 mt-1 col-5">
			Advanced Settings
		</div>
		<div class="">
			<%= link_to image_tag('downarrow.png', size: "10", class: ""), root_path %>
		</div>
	</div>
	
	<!-- set next action divider-->
	<div class="row">
		<div class="col-5 options_text_lite text-center ml-1 mt-2 mb-2">
			Set next Action
		</div>
		<div class="card_divider_three col-6 mt-3 mb-2"></div>
	</div>

	<!-- set next action -->
	<% if Node.where(bot_id: @bot.id, parent_id: parent_id).first%>
	<%= form_with scope: :set_next_action, url: nodes_update_options_path(@bot.id, @node.id), method: :put,  remote: true do |f| %>
		<div class="mt-1 ml-4">
			<%= f.radio_button :set_next_action , "add_a_node", id: "add_a_node"%>
			<%= f.label :set_next_action , "Add a node", value: "add_a_node" , class: "ml-2 options_text_bold"%>
		</div>
		<div class="mt-1 ml-4">
			<%= f.radio_button :set_next_action , "transfer_to_agent", id: "transfer_to_agent"%>
			<%= f.label :set_next_action , "Transfer to an agent", value: "transfer_to_agent" , class: "ml-2 options_text_bold"%>
		</div>
		<div class="mb-2 text-center hide" id="transfer_to_agent_message">
			<% if @node.transfer_to_agent_message%>
			<div class="dropdown show mb-2 ml-3">
			  <a class="btn btn-outline-secondary btn-sm dropdown-toggle" href="#" role="button" id="dropdownMenuLink_transfer" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false", style="width: 210px; background-color: transparent; color: black;">
			    Select Transfering group
			  </a>

			  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink_transfer", style="width: 210px;">
			    <a class="dropdown-item" href="#">Group-1</a>
			    <a class="dropdown-item" href="#">Group-2</a>
			    <a class="dropdown-item" href="#">Group-3</a>
			  </div>
			</div>
			<div class="ml-3">
			<%= text_area(:set_next_action, :transfer_to_agent_message, cols: 30, rows: 3, class: 'botresponses_exit_area p-2', value: @node.transfer_to_agent_message)%>
			</div>
			<% else %>
			<div class="dropdown show mb-2 ml-3">
			  <a class="btn btn-outline-secondary btn-sm dropdown-toggle" href="#" role="button" id="dropdownMenuLink_transfer1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false", style="width: 210px; background-color: transparent; color: black;">
			    Select Transfering group
			  </a>

			  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink_transfer1", style="width: 210px;">
			    <a class="dropdown-item" href="#">Group-1</a>
			    <a class="dropdown-item" href="#">Group-2</a>
			    <a class="dropdown-item" href="#">Group-3</a>
			  </div>
			</div>
			<div class="ml-3">
			<%= text_area(:set_next_action, :transfer_to_agent_message, cols: 30, rows: 3, class: 'botresponses_exit_area p-2', value: "Thank you. Now, you will be transferred to our agent.")%>
			</div>
			<% end %>
			<div class="text-center", style="font-size: 10px;">
				(Transfer to agent Message)
			</div>
		</div>
		<div class="mt-1 ml-4 mb-2">
			<%= f.radio_button :set_next_action , "exit_bot", id: "exit_bot", checked: "checked"%>
			<%= f.label :set_next_action , "Exit Conversation", value: "exit_bot" , class: "ml-2 options_text_bold"%>
		</div>
		<div class="mb-2 text-center ml-2" id="exit_message">
			<% if @node.exit_message%>
			<%= text_area(:set_next_action, :exit_bot_message, cols: 30, rows: 3, class: 'botresponses_exit_area p-2', value: @node.exit_message)%>
			<% else %>
			<%= text_area(:set_next_action, :exit_bot_message, cols: 30, rows: 3, class: 'botresponses_exit_area p-2', value: "Thank you. Its a great pleasure to have a conversation with you. ")%>
			<% end %>
			<div class="text-center", style="font-size: 10px;">
				(Exit Message)
			</div>
		</div>

		<div class="mb-2">
			<%= f.submit "Save",value: "Save", class: "btn btn-outline-secondary ml-3 mb-3", style: "width: 270px;"%>
		</div>
	<% end %>
	<% end %>
</div>


<script type="text/javascript">
	<% if Node.where(bot_id: @bot.id, parent_id: parent_id).first%>
		<% if @node.set_next_action == "add_a_node"%>
			document.getElementById("add_a_node").checked = true;
			document.getElementById("transfer_to_agent").checked = false;
			document.getElementById("exit_bot").checked = false;
			document.getElementById('exit_message').classList.add('hide');
			document.getElementById('transfer_to_agent_message').classList.add('hide');
		<% elsif @node.set_next_action == "transfer_to_agent"%>
			document.getElementById("add_a_node").checked = false;
			document.getElementById("transfer_to_agent").checked = true;
			document.getElementById("exit_bot").checked = false;
			document.getElementById('exit_message').classList.add('hide');
			document.getElementById('transfer_to_agent_message').classList.remove('hide');
		<% elsif @node.set_next_action == "exit_bot"%>
			document.getElementById("add_a_node").checked = false;
			document.getElementById("transfer_to_agent").checked = false;
			document.getElementById("exit_bot").checked = true;
			document.getElementById('exit_message').classList.remove('hide');
			document.getElementById('transfer_to_agent_message').classList.add('hide');
		<% end %>

		 document.getElementById('exit_bot').onclick = function() {
		 	document.getElementById('exit_message').classList.remove('hide');
		 	document.getElementById('transfer_to_agent_message').classList.add('hide');
		 }
		 document.getElementById('add_a_node').onclick = function() {
		 	document.getElementById('exit_message').classList.add('hide');
		 	document.getElementById('transfer_to_agent_message').classList.add('hide');
		 }
		 document.getElementById('transfer_to_agent').onclick = function() {
		 	document.getElementById('exit_message').classList.add('hide');
		 	document.getElementById('transfer_to_agent_message').classList.remove('hide');
		 }
	 <% end %>
</script>